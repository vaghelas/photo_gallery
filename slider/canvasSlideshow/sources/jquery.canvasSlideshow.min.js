/*
 * jQuery Canvas Slideshow Plugin
 * Examples and documentation at: http://www.webair.it/blog/
 * Copyright (c) 2010 Alessandro Scolavino
 * Version: 0.1 (2010-09-24)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 * Tested with: jQuery v1.4.2
 * Requires: jquery-lightbox 1.0.2 {@link http://www.balupton/projects/jquery-lightbox} or later if lightbox enabled
 *
 */
(function(b){var a=false;b(window).load(function(){a=true});b.fn.canvasSlideshow=function(l){var g=b(this),c=b.extend({},b.fn.canvasSlideshow.defaults,l),e=b.fn.extend(c,{imgs:g.find("img"),cnv_width:g.width(),cnv_height:g.height(),canvas_context:g[0].getContext("2d"),act_index:0,actual_step:0,white_space:0,start_pos_x:0,pos_y:0,moving:0,util_image:new Array(),pause:0,next_step:0,back_step:0,slideshow_interval:null});e.white_space=Math.floor((e.cnv_width-(e.img_width+2*e.border_size)*e.num_elem)/(e.num_elem));e.start_pos_x=e.white_space-10;e.pos_y=2*e.border_size;g.children().hide();var k=0,j=1,d=5,h=setInterval(function(){var m=255*k/100;e.canvas_context.fillStyle="rgb("+m+","+m+","+m+")";e.canvas_context.fillText(e.loader_text,(e.cnv_width/2)-(e.canvas_context.measureText(e.loader_text).width/2),15);k=k-j*d;if(k<=0){j=-1}else{if(k>=100){j=1}}},20);if(e.show_controls==true){prev_img=new Image();prev_img.src="images/prev.png";e.util_image[0]=prev_img;play_img=new Image();play_img.src="images/play.png";e.util_image[1]=play_img;pause_img=new Image();pause_img.src="images/pause.png";e.util_image[2]=pause_img;next_img=new Image();next_img.src="images/next.png";e.util_image[3]=next_img}g.click(function(n){offset=g.offset();cord_x=n.pageX-offset.left;cord_y=n.pageY-offset.top;if(((Math.floor(e.cnv_width/2)+16)>cord_x&&cord_x>(Math.floor(e.cnv_width/2)-16))&&(e.cnv_height-5>cord_y&&cord_y>e.cnv_height-41)){e.pause=(e.pause==0)?1:0}else{if((41>cord_x&&cord_x>5)&&(e.cnv_height-5>cord_y&&cord_y>e.cnv_height-41)&&(e.back_step==0)){e.back_step=1}else{if((e.cnv_width-5>cord_x&&cord_x>e.cnv_width-41)&&(e.cnv_height-5>cord_y&&cord_y>e.cnv_height-41)){e.next_step=1}else{if(e.lightbox==true){cont_inc=0;space=(e.start_pos_x+e.img_width);while(space<(e.cnv_width+(e.white_space+e.img_width))){if(cord_x<space){var m=new Image();m.src=e.imgs[e.act_index+cont_inc].src;m.alt=e.imgs[e.act_index+cont_inc].alt;b(m).lightbox().trigger("click");n.stopPropagation();return}space+=(e.white_space+e.img_width);cont_inc++}}}}}n.stopPropagation()});var f=function(){g.bind("canvas_slideshow.start",function(){if(e.pause==1){b.fn.draw(e);e.pause=2}if(e.pause==0){e.actual_step++;if((e.next_step==1||e.back_step==1)&&e.moving==0){e.actual_step=e.speed;e.next_step=0;if(e.back_step==1){e.back_step=2}}if(e.actual_step>=(e.speed/e.step)){if(e.back_step==2){e.start_pos_x+=4}else{e.start_pos_x-=4}b.fn.draw(e);e.moving=1}if((-e.start_pos_x>=e.img_width+15)||(e.start_pos_x>=e.img_width+2*e.white_space-15)){e.actual_step=0;e.start_pos_x=e.white_space-10;if(e.back_step==2){e.act_index--}else{e.act_index++}e.back_step=0;e.moving=0;if(e.act_index==e.imgs.length){e.act_index=0}if(e.act_index<0){e.act_index=e.imgs.length+e.act_index}}}});if(h){e.canvas_context.clearRect(0,0,e.cnv_width,e.cnv_height);clearInterval(h);b.fn.draw(e)}e.slideshow_interval=setInterval(function(){g.trigger("canvas_slideshow.start")},e.step)};if(a){f()}else{b(window).load(f)}};b.fn.draw=function(c){c.canvas_context.clearRect(0,0,c.cnv_width,c.cnv_height);c.pos_x=c.start_pos_x;if(c.back_step==2){c.pos_x-=(c.white_space+c.img_width);for(i=c.act_index-1;i<=(c.act_index+c.num_elem+1);i++){if(i>=c.imgs.length){current_i=i-c.imgs.length}else{if(i<0){current_i=c.imgs.length+i}else{current_i=i}}if(c.pos_x<c.cnv_width){if(c.show_box==true){b.fn.draw_box(c)}c.canvas_context.drawImage(c.imgs[current_i],c.pos_x,c.pos_y,c.img_width,c.img_height);if(c.show_description==true){b.fn.draw_text(c)}}c.pos_x+=(c.white_space+c.img_width)}}else{for(i=c.act_index;i<=(c.act_index+c.num_elem+1);i++){current_i=(i>=c.imgs.length)?i-c.imgs.length:i;if(c.pos_x<c.cnv_width){if(c.show_box==true){b.fn.draw_box(c)}c.canvas_context.drawImage(c.imgs[current_i],c.pos_x,c.pos_y,c.img_width,c.img_height);if(c.show_description==true){b.fn.draw_text(c)}}c.pos_x+=(c.white_space+c.img_width)}}if(c.show_controls==true){b.fn.draw_control(c)}};b.fn.draw_box=function(c){c.canvas_context.shadowBlur=10;c.canvas_context.shadowColor="#cccccc";c.canvas_context.shadowOffsetX=c.shadow_size;c.canvas_context.shadowOffsetY=c.shadow_size;c.canvas_context.fillStyle="#000000";c.canvas_context.fillRect(c.pos_x-c.border_size,c.pos_y-c.border_size,(c.img_width+2*c.border_size),(c.img_height+2*c.border_size+((c.show_description==true)?40:0)));c.canvas_context.shadowBlur=0;c.canvas_context.shadowOffsetX=0;c.canvas_context.shadowOffsetY=0};b.fn.draw_text=function(c){c.canvas_context.shadowBlur=20;c.canvas_context.shadowColor="#ffffff";c.canvas_context.shadowOffsetX=2;c.canvas_context.shadowOffsetY=1;description_text=c.imgs[current_i].alt;c.canvas_context.font="Times new roman";c.canvas_context.textAlign="center";c.canvas_context.textBaseline="middle";c.canvas_context.fillStyle="#ffffff";metrics=c.canvas_context.measureText(description_text);if(metrics.width>c.img_width){c.canvas_context.fillText(description_text.slice(0,Math.floor((description_text.length)/2)),c.pos_x+Math.floor(c.img_width/2),(c.pos_y+c.img_height+10),c.img_width);c.canvas_context.fillText(description_text.slice(Math.floor((description_text.length)/2)),c.pos_x+Math.floor(c.img_width/2),(c.pos_y+c.img_height+30),c.img_width)}else{c.canvas_context.fillText(description_text,c.pos_x+Math.floor(c.img_width/2),(c.pos_y+c.img_height+10),c.img_width)}c.canvas_context.shadowBlur=0;c.canvas_context.shadowOffsetX=0;c.canvas_context.shadowOffsetY=0};b.fn.draw_control=function(c){c.canvas_context.drawImage(c.util_image[0],5,c.cnv_height-41,36,36);if(c.pause==1){c.canvas_context.drawImage(c.util_image[1],(Math.floor(c.cnv_width/2)-16),c.cnv_height-41,36,36)}else{c.canvas_context.drawImage(c.util_image[2],(Math.floor(c.cnv_width/2)-16),c.cnv_height-41,36,36)}c.canvas_context.drawImage(c.util_image[3],c.cnv_width-41,c.cnv_height-41,36,36)};b.fn.canvasSlideshow.defaults={img_width:200,img_height:150,border_size:5,shadow_size:5,num_elem:3,show_description:true,show_box:true,show_controls:true,lightbox:true,speed:2000,step:20,loader_text:"Loading, please wait!"}})(jQuery);